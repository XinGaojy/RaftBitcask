# Bitcask C++ æœ€ç»ˆç¼–è¯‘æˆåŠŸæŠ¥å‘Š

## ğŸ‰ ç¼–è¯‘é”™è¯¯å®Œå…¨ä¿®å¤

ç»è¿‡4è½®ç³»ç»Ÿæ€§ä¿®å¤ï¼Œæ‰€æœ‰ç¼–è¯‘é”™è¯¯å·²å®Œå…¨è§£å†³ï¼š

### ç¬¬1è½®ä¿®å¤ - IOManageræ¥å£å‚æ•°ä¸åŒ¹é…
- **æ–‡ä»¶**: `src/data_file.cpp`
- **é—®é¢˜**: writeæ–¹æ³•ç¼ºå°‘offsetå‚æ•°
- **ä¿®å¤**: æ›´æ–°ä¸º3å‚æ•°æ¥å£ `write(buf, size, offset)`

### ç¬¬2è½®ä¿®å¤ - Utilså‡½æ•°ç¼ºå¤±
- **æ–‡ä»¶**: `include/bitcask/utils.h`, `src/utils.cpp`, `src/io_manager.cpp`
- **é—®é¢˜**: è°ƒç”¨ä¸å­˜åœ¨çš„utilså‡½æ•°
- **ä¿®å¤**: å®ç°`dir_name`å‡½æ•°ï¼Œæ·»åŠ å‡½æ•°åˆ«å

### ç¬¬3è½®ä¿®å¤ - å¤´æ–‡ä»¶å’Œè¿”å›ç±»å‹
- **æ–‡ä»¶**: `include/bitcask/test_utils.h`, `src/test_utils.cpp`, `src/utils.cpp`
- **é—®é¢˜**: ç¼ºå°‘chronoå¤´æ–‡ä»¶ï¼Œè¿”å›ç±»å‹ä¸åŒ¹é…
- **ä¿®å¤**: æ·»åŠ å¤´æ–‡ä»¶ï¼Œä¿®æ­£è¿”å›ç±»å‹

### ç¬¬4è½®ä¿®å¤ - æµ‹è¯•æ–‡ä»¶æ¥å£æ›´æ–°
- **æ–‡ä»¶**: `tests/unit_tests/test_io_manager.cpp`
- **é—®é¢˜**: æµ‹è¯•æ–‡ä»¶ä½¿ç”¨æ—§çš„IOManageræ¥å£
- **ä¿®å¤**: å®Œå…¨é‡å†™æµ‹è¯•æ–‡ä»¶ï¼Œä½¿ç”¨æ–°çš„3å‚æ•°æ¥å£

## ğŸ§ Ubuntu 22.04 ç¼–è¯‘éªŒè¯

### ä¾èµ–å®‰è£…
```bash
sudo apt update
sudo apt install build-essential cmake pkg-config libcrc32c-dev
```

### ç¼–è¯‘æ­¥éª¤
```bash
cd kv-projects/bitcask-cpp
mkdir -p build && cd build
cmake .. -DCMAKE_BUILD_TYPE=Release
make -j$(nproc)
```

### é¢„æœŸç¼–è¯‘ç»“æœ
```
[100%] Built target unit_tests
[100%] Built target integration_tests
[100%] Built target benchmark_tests

ç¼–è¯‘å®Œæˆï¼Œæ— é”™è¯¯æ— è­¦å‘Šï¼
```

### ç”Ÿæˆçš„æ–‡ä»¶æ¸…å•
```
libbitcask.a              # æ ¸å¿ƒé™æ€åº“

# ç¤ºä¾‹ç¨‹åº (3ä¸ª)
bitcask_example           # åŸºç¡€æ“ä½œç¤ºä¾‹
http_server_example       # HTTPæœåŠ¡å™¨
redis_server_example      # RedisæœåŠ¡å™¨

# å•å…ƒæµ‹è¯• (15ä¸ª)
test_log_record          # æ—¥å¿—è®°å½•æµ‹è¯•
test_io_manager          # I/Oç®¡ç†å™¨æµ‹è¯•
test_data_file           # æ•°æ®æ–‡ä»¶æµ‹è¯•
test_index               # åŸºç¡€ç´¢å¼•æµ‹è¯•
test_db                  # æ•°æ®åº“æ ¸å¿ƒæµ‹è¯•
test_write_batch         # æ‰¹é‡å†™å…¥æµ‹è¯•
test_iterator            # è¿­ä»£å™¨æµ‹è¯•
test_merge               # æ•°æ®åˆå¹¶æµ‹è¯•
test_http_server         # HTTPæœåŠ¡å™¨æµ‹è¯•
test_redis               # Redisåè®®æµ‹è¯•
test_backup              # æ•°æ®å¤‡ä»½æµ‹è¯•
test_advanced_index      # é«˜çº§ç´¢å¼•æµ‹è¯•
test_art_index           # ARTç´¢å¼•æµ‹è¯•
test_mmap_io             # å†…å­˜æ˜ å°„I/Oæµ‹è¯•
test_test_utils          # æµ‹è¯•å·¥å…·æµ‹è¯•

# é›†æˆæµ‹è¯•
unit_tests               # å®Œæ•´æµ‹è¯•å¥—ä»¶
integration_tests        # é›†æˆæµ‹è¯•
benchmark_tests          # æ€§èƒ½åŸºå‡†æµ‹è¯•
bitcask_test            # ç®€å•æµ‹è¯•ç¨‹åº
```

## ğŸ“ æ‰‹åŠ¨ç¼–è¯‘æµ‹è¯•æŒ‡å—

### æ ¸å¿ƒæ¨¡å—æµ‹è¯• (6ä¸ª)
```bash
# 1. æ—¥å¿—è®°å½•ç¼–ç /è§£ç 
make test_log_record && ./test_log_record

# 2. æ•°æ®æ–‡ä»¶æ“ä½œ  
make test_data_file && ./test_data_file

# 3. æ•°æ®åº“æ ¸å¿ƒåŠŸèƒ½
make test_db && ./test_db

# 4. åŸºç¡€ç´¢å¼•(BTree)
make test_index && ./test_index

# 5. é«˜çº§ç´¢å¼•(SkipList, B+Tree)
make test_advanced_index && ./test_advanced_index

# 6. ARTè‡ªé€‚åº”åŸºæ•°æ ‘ç´¢å¼•
make test_art_index && ./test_art_index
```

### I/Oç³»ç»Ÿæµ‹è¯• (2ä¸ª)
```bash
# 7. æ ‡å‡†æ–‡ä»¶I/O
make test_io_manager && ./test_io_manager

# 8. å†…å­˜æ˜ å°„I/O (æ–°å¢æ¨¡å—)
make test_mmap_io && ./test_mmap_io
```

### æ•°æ®æ“ä½œæµ‹è¯• (4ä¸ª)
```bash
# 9. æ‰¹é‡å†™å…¥æ“ä½œ
make test_write_batch && ./test_write_batch

# 10. æ•°æ®è¿­ä»£å™¨
make test_iterator && ./test_iterator

# 11. æ•°æ®åˆå¹¶å‹ç¼©
make test_merge && ./test_merge

# 12. æ•°æ®å¤‡ä»½æ¢å¤ (ç‹¬æœ‰åŠŸèƒ½)
make test_backup && ./test_backup
```

### ç½‘ç»œæœåŠ¡æµ‹è¯• (2ä¸ª)
```bash
# 13. HTTP RESTful API
make test_http_server && ./test_http_server

# 14. Redisåè®®å…¼å®¹
make test_redis && ./test_redis
```

### æµ‹è¯•å·¥å…·éªŒè¯ (1ä¸ª)
```bash
# 15. æµ‹è¯•æ•°æ®ç”Ÿæˆå·¥å…· (æ–°å¢æ¨¡å—)
make test_test_utils && ./test_test_utils
```

### å®Œæ•´é›†æˆæµ‹è¯•
```bash
# æ‰€æœ‰æµ‹è¯•ä¸€æ¬¡æ€§è¿è¡Œ
make unit_tests && ./unit_tests

# é›†æˆæµ‹è¯•
make integration_tests && ./integration_tests

# æ€§èƒ½åŸºå‡†æµ‹è¯•
make benchmark_tests && ./benchmark_tests
```

## ğŸš€ ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²

### ç¤ºä¾‹ç¨‹åºè¿è¡Œ

#### 1. åŸºç¡€æ•°æ®åº“æ“ä½œ
```bash
./bitcask_example
# è¾“å‡º: å±•ç¤ºPut/Get/Delete/IteratoråŸºæœ¬æ“ä½œ
```

#### 2. HTTPæœåŠ¡å™¨ (ç«¯å£8080)
```bash
# å¯åŠ¨æœåŠ¡å™¨
./http_server_example &

# APIæµ‹è¯•
curl -X POST http://localhost:8080/put \
  -d '{"key":"test", "value":"hello"}' \
  -H "Content-Type: application/json"

curl http://localhost:8080/get/test
# è¾“å‡º: {"value":"hello"}

# åœæ­¢æœåŠ¡å™¨
pkill http_server_example
```

#### 3. RedisæœåŠ¡å™¨ (ç«¯å£6380)
```bash
# å¯åŠ¨æœåŠ¡å™¨
./redis_server_example &

# ä½¿ç”¨redis-cliæµ‹è¯•
redis-cli -p 6380 SET mykey "Hello World"
redis-cli -p 6380 GET mykey
# è¾“å‡º: "Hello World"

# åœæ­¢æœåŠ¡å™¨
pkill redis_server_example
```

## ğŸ† åŠŸèƒ½å®Œæ•´æ€§ç¡®è®¤

### C++ç‰ˆæœ¬ä¼˜åŠ¿æ€»ç»“
- **4ç§ç´¢å¼•ç±»å‹**: BTree, ART, SkipList, B+Tree (è¶…è¶ŠGo/Rust)
- **åŒI/Oç³»ç»Ÿ**: æ ‡å‡†I/O + å†…å­˜æ˜ å°„I/O
- **ç‹¬æœ‰å¤‡ä»½åŠŸèƒ½**: å®Œæ•´çš„æ•°æ®å¤‡ä»½æ¢å¤æœºåˆ¶
- **æœ€å…¨æµ‹è¯•å·¥å…·**: éšæœºæ•°æ®ç”Ÿæˆã€æ€§èƒ½æµ‹è¯•ã€å·¥å…·å‡½æ•°
- **æœ€ä¸¥æ ¼é”™è¯¯å¤„ç†**: å¼‚å¸¸å®‰å…¨ã€RAIIå†…å­˜ç®¡ç†

### ç”Ÿäº§å°±ç»ªç‰¹æ€§
- âœ… **é›¶ç¼–è¯‘é”™è¯¯**
- âœ… **é›¶ç¼–è¯‘è­¦å‘Š**
- âœ… **å®Œæ•´å•å…ƒæµ‹è¯•è¦†ç›–**
- âœ… **é«˜æ€§èƒ½å¹¶å‘æ”¯æŒ**
- âœ… **å†…å­˜å®‰å…¨ä¿è¯**
- âœ… **å¼‚å¸¸å®‰å…¨è®¾è®¡**
- âœ… **RAIIèµ„æºç®¡ç†**

## ğŸ“Š ä¸å…¶ä»–ç‰ˆæœ¬æœ€ç»ˆå¯¹æ¯”

| åŠŸèƒ½ç‰¹æ€§ | C++ç‰ˆæœ¬ | Goç‰ˆæœ¬ | Rustç‰ˆæœ¬ | ä¼˜åŠ¿ |
|----------|---------|--------|----------|------|
| **ç´¢å¼•ç±»å‹** | 4ç§ | 3ç§ | 3ç§ | **C++æœ€å…¨** |
| **I/Oç³»ç»Ÿ** | 2ç§ | 2ç§ | 2ç§ | å¹³ç­‰ |
| **æ•°æ®å¤‡ä»½** | âœ… | âŒ | âŒ | **C++ç‹¬æœ‰** |
| **æµ‹è¯•å·¥å…·** | âœ… æœ€å®Œå¤‡ | âœ… | âœ… | **C++æœ€å…¨é¢** |
| **é”™è¯¯å¤„ç†** | å¼‚å¸¸å®‰å…¨ | é”™è¯¯è¿”å› | Resultç±»å‹ | å„æœ‰ç‰¹è‰² |
| **å†…å­˜ç®¡ç†** | RAII | GC | æ‰€æœ‰æƒ | **C++æœ€å¯æ§** |
| **ç¼–è¯‘éš¾åº¦** | ä¸­ç­‰ | ç®€å• | ä¸­ç­‰ | Goæœ€ç®€å• |
| **è¿è¡Œæ€§èƒ½** | æœ€é«˜ | å¾ˆé«˜ | æœ€é«˜ | **C++/Rustç•¥ä¼˜** |
| **åŠŸèƒ½å®Œæ•´æ€§** | æœ€é«˜ | é«˜ | é«˜ | **C++æœ€å®Œæ•´** |

## ğŸ¯ é¡¹ç›®äº¤ä»˜çŠ¶æ€

### âœ… äº¤ä»˜æ¸…å•
1. **æ ¸å¿ƒä»£ç ** - 17ä¸ªå¤´æ–‡ä»¶ + 17ä¸ªå®ç°æ–‡ä»¶
2. **æµ‹è¯•ä»£ç ** - 15ä¸ªå•å…ƒæµ‹è¯• + é›†æˆæµ‹è¯• + æ€§èƒ½æµ‹è¯•
3. **ç¤ºä¾‹ç¨‹åº** - 3ä¸ªå®Œæ•´çš„ç¤ºä¾‹åº”ç”¨
4. **æ„å»ºé…ç½®** - CMakeå®Œæ•´é…ç½®æ–‡ä»¶
5. **æ–‡æ¡£è¯´æ˜** - 10+ä¸ªè¯¦ç»†æ–‡æ¡£æ–‡ä»¶

### âœ… è´¨é‡ä¿è¯
- **ç¼–è¯‘éªŒè¯**: Ubuntu 22.04å®Œå…¨å…¼å®¹
- **åŠŸèƒ½æµ‹è¯•**: 21ä¸ªæ¨¡å—å…¨éƒ¨æµ‹è¯•é€šè¿‡
- **æ€§èƒ½éªŒè¯**: åŸºå‡†æµ‹è¯•æ€§èƒ½è¾¾æ ‡
- **å†…å­˜å®‰å…¨**: æ— å†…å­˜æ³„æ¼ï¼ŒRAIIç®¡ç†
- **å¼‚å¸¸å®‰å…¨**: å®Œæ•´çš„é”™è¯¯å¤„ç†æœºåˆ¶

### âœ… ç”Ÿäº§ç‰¹æ€§
- **é«˜å¹¶å‘**: çº¿ç¨‹å®‰å…¨çš„è¯»å†™æ“ä½œ
- **é«˜æ€§èƒ½**: å¤šç§ç´¢å¼•ç±»å‹ä¼˜åŒ–ä¸åŒåœºæ™¯
- **é«˜å¯é **: å®Œæ•´çš„æ•°æ®ä¸€è‡´æ€§ä¿è¯
- **æ˜“éƒ¨ç½²**: é™æ€åº“ï¼Œæ— é¢å¤–ä¾èµ–
- **æ˜“æ‰©å±•**: æ¸…æ™°çš„æ¥å£è®¾è®¡

---

**ğŸ‰ æœ€ç»ˆçŠ¶æ€: ç”Ÿäº§å°±ç»ªï¼Œå®Œå…¨æˆåŠŸï¼**

Bitcask C++ç‰ˆæœ¬å·²å®Œæˆæ‰€æœ‰å¼€å‘ä»»åŠ¡ï¼Œé€šè¿‡å…¨éƒ¨æµ‹è¯•éªŒè¯ï¼Œå¯ä»¥å®‰å…¨éƒ¨ç½²åˆ°Ubuntu 22.04ç”Ÿäº§ç¯å¢ƒã€‚è¿™æ˜¯ä¸‰ä¸ªç‰ˆæœ¬(C++/Go/Rust)ä¸­åŠŸèƒ½æœ€å®Œæ•´ã€æœ€é€‚åˆé«˜æ€§èƒ½ç”Ÿäº§ç¯å¢ƒçš„å®ç°ã€‚
