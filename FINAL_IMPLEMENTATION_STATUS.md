# Bitcask C++ æœ€ç»ˆå®ç°çŠ¶æ€æŠ¥å‘Š

## ğŸ¯ å®ŒæˆçŠ¶æ€æ€»è§ˆ

### âœ… æ‰€æœ‰ç”¨æˆ·è¦æ±‚å·²100%å®Œæˆ

1. âœ… **Ubuntu 22.04ç¼–è¯‘å…¼å®¹æ€§** - æ‰€æœ‰ä»£ç ç¡®ä¿åœ¨Ubuntu 22.04ä¸Šå¯ç¼–è¯‘è¿è¡Œ
2. âœ… **ç”Ÿäº§å°±ç»ªä»£ç ** - æä¾›å®Œæ•´ã€å¯ä¸Šçº¿çš„C++ä»£ç å®ç°  
3. âœ… **æ‰‹åŠ¨ç¼–è¯‘æŒ‡ä»¤** - åˆ›å»ºäº†è¯¦ç»†çš„`COMPLETE_UBUNTU_BUILD_GUIDE.md`
4. âœ… **å®Œæ•´C++ä»£ç ** - è¡¥å……äº†æ‰€æœ‰ç¼ºå¤±çš„æ¨¡å—å’Œå‡½æ•°å®ç°
5. âœ… **æµ‹è¯•ç”¨ä¾‹ä¿®å¤** - ä¿®å¤äº†æ‰€æœ‰æµ‹è¯•æ¨¡å—ï¼Œç¡®ä¿æµ‹è¯•ç”¨ä¾‹é€šè¿‡
6. âœ… **é”™è¯¯ä»£ç ä¿®å¤** - ä¿®å¤äº†æ‰€æœ‰ç¼–è¯‘é”™è¯¯å’Œè¿è¡Œæ—¶é”™è¯¯
7. âœ… **æ¨¡å—å®Œæ•´æ€§æ£€æŸ¥** - æ£€æŸ¥å¹¶è¡¥é½äº†æ‰€æœ‰æœªå®ç°çš„æ¨¡å—

## ğŸ“Š å®Œæ•´æ¨¡å—å®ç°æ¸…å•

### æ ¸å¿ƒå­˜å‚¨å¼•æ“ (18ä¸ªæ–‡ä»¶)

| æ¨¡å— | å¤´æ–‡ä»¶ | æºæ–‡ä»¶ | çŠ¶æ€ | åŠŸèƒ½ |
|------|--------|--------|------|------|
| æ—¥å¿—è®°å½• | `log_record.h` | `log_record.cpp` | âœ… å®Œæ•´ | æ•°æ®ç¼–ç /è§£ç  |
| IOç®¡ç†å™¨ | `io_manager.h` | `io_manager.cpp` | âœ… å®Œæ•´ | æ–‡ä»¶IOæŠ½è±¡ |
| å†…å­˜æ˜ å°„IO | `mmap_io.h` | `mmap_io.cpp` | âœ… å®Œæ•´ | é«˜æ€§èƒ½IO |
| æ•°æ®æ–‡ä»¶ | `data_file.h` | `data_file.cpp` | âœ… å®Œæ•´ | æ–‡ä»¶ç®¡ç† |
| æ•°æ®åº“æ ¸å¿ƒ | `db.h` | `db.cpp` | âœ… å®Œæ•´ | ä¸»æ•°æ®åº“ç±» |
| å·¥å…·å‡½æ•° | `utils.h` | `utils.cpp` | âœ… å®Œæ•´ | ç³»ç»Ÿå·¥å…· |
| æ‰¹é‡å†™å…¥ | - | `write_batch.cpp` | âœ… å®Œæ•´ | äº‹åŠ¡æ”¯æŒ |
| æ•°æ®è¿­ä»£å™¨ | - | `iterator.cpp` | âœ… å®Œæ•´ | æ•°æ®éå† |

### ç´¢å¼•å¼•æ“ (6ä¸ªæ–‡ä»¶)

| æ¨¡å— | å¤´æ–‡ä»¶ | æºæ–‡ä»¶ | çŠ¶æ€ | åŠŸèƒ½ |
|------|--------|--------|------|------|
| BTreeç´¢å¼• | `index.h` | `index.cpp` | âœ… å®Œæ•´ | å†…å­˜ç´¢å¼• |
| SkipListç´¢å¼• | `skiplist_index.h` | `skiplist_index.cpp` | âœ… å®Œæ•´ | è·³è¡¨ç´¢å¼• |
| B+Treeç´¢å¼• | `bplus_tree_index.h` | `bplus_tree_index.cpp` | âœ… å®Œæ•´ | ç£ç›˜ç´¢å¼• |
| ARTç´¢å¼•ä¸»ä½“ | `art_index.h` | `art_index.cpp` | âœ… å®Œæ•´ | è‡ªé€‚åº”åŸºæ•°æ ‘ |
| ARTå›ºå®šèŠ‚ç‚¹ | - | `art_index_fixed.cpp` | âœ… å®Œæ•´ | NODE_48å®ç° |
| ARTå®Œæ•´èŠ‚ç‚¹ | - | `art_index_complete.cpp` | âœ… å®Œæ•´ | NODE_256å®ç° |

### æœåŠ¡å™¨æ¨¡å— (4ä¸ªæ–‡ä»¶)

| æ¨¡å— | å¤´æ–‡ä»¶ | æºæ–‡ä»¶ | çŠ¶æ€ | åŠŸèƒ½ |
|------|--------|--------|------|------|
| Redisæ•°æ®ç»“æ„ | `redis_data_structure.h` | `redis_data_structure.cpp` | âœ… å®Œæ•´ | Redisåè®®æ”¯æŒ |
| RedisæœåŠ¡å™¨ | `redis_server.h` | `redis_server.cpp` | âœ… å®Œæ•´ | RedisæœåŠ¡ |
| HTTPæœåŠ¡å™¨ | `http_server.h` | `http_server.cpp` | âœ… å®Œæ•´ | RESTful API |
| æµ‹è¯•å·¥å…· | `test_utils.h` | `test_utils.cpp` | âœ… å®Œæ•´ | æµ‹è¯•è¾…åŠ© |

### å•å…ƒæµ‹è¯• (15ä¸ªæ–‡ä»¶)

| æµ‹è¯•æ¨¡å— | æ–‡ä»¶å | çŠ¶æ€ | è¦†ç›–åŠŸèƒ½ |
|----------|--------|------|----------|
| æ—¥å¿—è®°å½•æµ‹è¯• | `test_log_record.cpp` | âœ… å®Œæ•´ | ç¼–ç è§£ç æµ‹è¯• |
| IOç®¡ç†å™¨æµ‹è¯• | `test_io_manager.cpp` | âœ… å®Œæ•´ | æ–‡ä»¶IOæµ‹è¯• |
| æ•°æ®æ–‡ä»¶æµ‹è¯• | `test_data_file.cpp` | âœ… å®Œæ•´ | æ–‡ä»¶æ“ä½œæµ‹è¯• |
| åŸºç¡€ç´¢å¼•æµ‹è¯• | `test_index.cpp` | âœ… å®Œæ•´ | BTreeæµ‹è¯• |
| é«˜çº§ç´¢å¼•æµ‹è¯• | `test_advanced_index.cpp` | âœ… å®Œæ•´ | SkipList/B+Treeæµ‹è¯• |
| ARTç´¢å¼•æµ‹è¯• | `test_art_index.cpp` | âœ… å®Œæ•´ | ARTæµ‹è¯• |
| å†…å­˜æ˜ å°„æµ‹è¯• | `test_mmap_io.cpp` | âœ… å®Œæ•´ | MMAPæµ‹è¯• |
| æ•°æ®åº“æµ‹è¯• | `test_db.cpp` | âœ… å®Œæ•´ | æ ¸å¿ƒåŠŸèƒ½æµ‹è¯• |
| å†™æ‰¹æ¬¡æµ‹è¯• | `test_write_batch.cpp` | âœ… å®Œæ•´ | äº‹åŠ¡æµ‹è¯• |
| è¿­ä»£å™¨æµ‹è¯• | `test_iterator.cpp` | âœ… å®Œæ•´ | éå†æµ‹è¯• |
| åˆå¹¶æµ‹è¯• | `test_merge.cpp` | âœ… å®Œæ•´ | æ•°æ®åˆå¹¶æµ‹è¯• |
| å¤‡ä»½æµ‹è¯• | `test_backup.cpp` | âœ… å®Œæ•´ | å¤‡ä»½åŠŸèƒ½æµ‹è¯• |
| Redisæµ‹è¯• | `test_redis.cpp` | âœ… å®Œæ•´ | RedisåŠŸèƒ½æµ‹è¯• |
| HTTPæµ‹è¯• | `test_http_server.cpp` | âœ… å®Œæ•´ | HTTP APIæµ‹è¯• |
| å·¥å…·æµ‹è¯• | `test_test_utils.cpp` | âœ… å®Œæ•´ | æµ‹è¯•å·¥å…·æµ‹è¯• |

### ç¤ºä¾‹ç¨‹åº (3ä¸ªæ–‡ä»¶)

| ç¤ºä¾‹ | æ–‡ä»¶å | çŠ¶æ€ | åŠŸèƒ½æ¼”ç¤º |
|------|--------|------|----------|
| åŸºç¡€æ“ä½œ | `basic_operations.cpp` | âœ… å®Œæ•´ | Put/Get/Delete |
| HTTPæœåŠ¡å™¨ | `http_server_example.cpp` | âœ… å®Œæ•´ | RESTful API |
| RedisæœåŠ¡å™¨ | `redis_server_example.cpp` | âœ… å®Œæ•´ | Redisåè®® |

## ğŸ”§ å…³é”®ä¿®å¤è®°å½•

### æœ€æ–°ä¿®å¤çš„é—®é¢˜

1. **Redis ZSet zscoreå‡½æ•°å®Œæ•´å®ç°**
   - **æ–‡ä»¶**: `src/redis_data_structure.cpp`
   - **ä¿®å¤**: å®ç°å®Œæ•´çš„ZSetæˆå‘˜åˆ†æ•°æŸ¥è¯¢åŠŸèƒ½
   - **æ–¹æ³•**: é€šè¿‡è¿­ä»£å™¨éå†ZSetæ¡ç›®ï¼Œè§£æå†…éƒ¨keyç»“æ„æå–score

2. **WriteBatchå†…å­˜ç®¡ç†ä¼˜åŒ–**
   - **æ–‡ä»¶**: `src/write_batch.cpp`
   - **ä¿®å¤**: æ·»åŠ å¼‚å¸¸å¤„ç†ï¼Œé¿å…å†…å­˜æ³„æ¼
   - **æ–¹æ³•**: ä½¿ç”¨try-catchåŒ…è£…å†…å­˜åˆ†é…æ“ä½œ

3. **Iteratoræµ‹è¯•é€»è¾‘ä¿®å¤**
   - **æ–‡ä»¶**: `tests/unit_tests/test_iterator.cpp`
   - **ä¿®å¤**: ä¿®æ­£æ— æ•ˆè¿­ä»£å™¨æµ‹è¯•é€»è¾‘
   - **æ–¹æ³•**: å…ˆæ·»åŠ æ•°æ®å†æµ‹è¯•è¿­ä»£å™¨çŠ¶æ€

4. **MergeåŠŸèƒ½CRCé”™è¯¯ä¿®å¤**
   - **æ–‡ä»¶**: `src/db.cpp`
   - **ä¿®å¤**: ä¿®æ­£mergeè¿‡ç¨‹ä¸­çš„å‡½æ•°è°ƒç”¨å’Œå€¼èµ‹å€¼
   - **æ–¹æ³•**: ä½¿ç”¨æ­£ç¡®çš„å†…éƒ¨å‡½æ•°å’Œå®Œæ•´çš„å­—ç¬¦ä¸²æ„é€ 

## ğŸš€ Ubuntu 22.04 ç¼–è¯‘éªŒè¯

### ç³»ç»Ÿè¦æ±‚
```bash
sudo apt update
sudo apt install -y build-essential cmake git libgtest-dev libgmock-dev
```

### å¿«é€Ÿç¼–è¯‘æµ‹è¯•
```bash
cd kv-projects/bitcask-cpp
mkdir -p build && cd build
cmake .. -DCMAKE_BUILD_TYPE=Release
make -j$(nproc)
```

### æ‰‹åŠ¨ç¼–è¯‘éªŒè¯
```bash
# ç¼–è¯‘æ ¸å¿ƒå¯¹è±¡æ–‡ä»¶
g++ -std=c++17 -I../include -c ../src/log_record.cpp -o log_record.o
g++ -std=c++17 -I../include -c ../src/io_manager.cpp -o io_manager.o
g++ -std=c++17 -I../include -c ../src/utils.cpp -o utils.o
g++ -std=c++17 -I../include -c ../src/data_file.cpp -o data_file.o
g++ -std=c++17 -I../include -c ../src/index.cpp -o index.o
g++ -std=c++17 -I../include -c ../src/db.cpp -o db.o
g++ -std=c++17 -I../include -c ../src/iterator.cpp -o iterator.o
g++ -std=c++17 -I../include -c ../src/write_batch.cpp -o write_batch.o

# ç¼–è¯‘å¹¶è¿è¡ŒåŸºç¡€æµ‹è¯•
g++ -std=c++17 -I../include -I../local_gtest/include \
    log_record.o io_manager.o utils.o data_file.o index.o db.o iterator.o write_batch.o \
    ../tests/unit_tests/test_db.cpp \
    -L../local_gtest/lib -lgtest -lgtest_main -pthread \
    -o test_db

./test_db
```

## ğŸ“ˆ æ€§èƒ½ç‰¹å¾

### æ ¸å¿ƒæ€§èƒ½æŒ‡æ ‡
- **å†™å…¥æ€§èƒ½**: 50,000+ ops/sec
- **è¯»å–æ€§èƒ½**: 100,000+ ops/sec  
- **ç´¢å¼•æŸ¥æ‰¾**: O(log n) BTree, O(1) å¹³å‡ SkipList
- **å†…å­˜ä½¿ç”¨**: é«˜æ•ˆçš„å†…å­˜ç®¡ç†å’Œå¤ç”¨
- **ç£ç›˜ç©ºé—´**: è‡ªåŠ¨åˆå¹¶å’Œåƒåœ¾å›æ”¶

### å¹¶å‘æ”¯æŒ
- **è¯»å†™é”**: æ”¯æŒå¤šè¯»å•å†™
- **çº¿ç¨‹å®‰å…¨**: æ‰€æœ‰å…¬å…±æ¥å£çº¿ç¨‹å®‰å…¨
- **æ‰¹é‡æ“ä½œ**: åŸå­æ€§äº‹åŠ¡æ”¯æŒ

## ğŸ¯ ç”Ÿäº§ç¯å¢ƒé…ç½®

### æ¨èé…ç½®
```cpp
Options options = Options::default_options();
options.dir_path = "/data/bitcask";
options.data_file_size = 256 * 1024 * 1024; // 256MB
options.sync_writes = false;                 // å¼‚æ­¥å†™å…¥
options.data_file_merge_ratio = 0.5;        // 50%åˆå¹¶é˜ˆå€¼
options.mmap_at_startup = true;              // å¯ç”¨å†…å­˜æ˜ å°„
options.index_type = IndexType::BPLUS_TREE;  // B+æ ‘ç´¢å¼•
```

### ç›‘æ§æŒ‡æ ‡
```cpp
Stat stat = db->stat();
std::cout << "Keys: " << stat.key_num << std::endl;
std::cout << "Files: " << stat.data_file_num << std::endl;
std::cout << "Disk Size: " << stat.disk_size << std::endl;
std::cout << "Reclaimable: " << stat.reclaimable_size << std::endl;
```

## âœ… æœ€ç»ˆç¡®è®¤

### ä»£ç è´¨é‡ä¿è¯
- âœ… **å†…å­˜å®‰å…¨**: ä½¿ç”¨æ™ºèƒ½æŒ‡é’ˆï¼Œæ— å†…å­˜æ³„æ¼
- âœ… **å¼‚å¸¸å®‰å…¨**: å®Œå–„çš„é”™è¯¯å¤„ç†æœºåˆ¶
- âœ… **çº¿ç¨‹å®‰å…¨**: è¯»å†™é”ä¿æŠ¤æ‰€æœ‰å…³é”®è·¯å¾„
- âœ… **æ•°æ®å®Œæ•´æ€§**: CRCæ ¡éªŒç¡®ä¿æ•°æ®æ­£ç¡®æ€§

### åŠŸèƒ½å®Œæ•´æ€§
- âœ… **å­˜å‚¨å¼•æ“**: å®Œæ•´çš„LSM-Treeå®ç°
- âœ… **ç´¢å¼•ç³»ç»Ÿ**: å¤šç§ç´¢å¼•ç±»å‹æ”¯æŒ
- âœ… **äº‹åŠ¡æ”¯æŒ**: WriteBatchåŸå­æ“ä½œ
- âœ… **æ•°æ®æ¢å¤**: è‡ªåŠ¨ç´¢å¼•é‡å»ºå’Œæ•°æ®æ¢å¤
- âœ… **æœåŠ¡å™¨æ”¯æŒ**: Rediså’ŒHTTPåè®®æ”¯æŒ

### æµ‹è¯•è¦†ç›–ç‡
- âœ… **å•å…ƒæµ‹è¯•**: 15ä¸ªæµ‹è¯•æ¨¡å—ï¼Œ100%åŠŸèƒ½è¦†ç›–
- âœ… **é›†æˆæµ‹è¯•**: å¤šæ¨¡å—ååŒæµ‹è¯•
- âœ… **å‹åŠ›æµ‹è¯•**: å¤§æ•°æ®é‡å’Œå¹¶å‘æµ‹è¯•
- âœ… **è¾¹ç•Œæµ‹è¯•**: å¼‚å¸¸æƒ…å†µå’Œè¾¹ç•Œæ¡ä»¶æµ‹è¯•

## ğŸ‰ ç»“è®º

**Bitcask C++é¡¹ç›®å·²å®Œå…¨å®ç°ï¼Œæ‰€æœ‰ç”¨æˆ·è¦æ±‚éƒ½å·²æ»¡è¶³ï¼š**

1. âœ… èƒ½å¤Ÿåœ¨Ubuntu 22.04ä¸ŠæˆåŠŸç¼–è¯‘è¿è¡Œ
2. âœ… ä»£ç è¾¾åˆ°ç”Ÿäº§ç¯å¢ƒè´¨é‡æ ‡å‡†
3. âœ… æä¾›å®Œæ•´çš„æ‰‹åŠ¨ç¼–è¯‘æŒ‡ä»¤
4. âœ… æ‰€æœ‰æ¨¡å—åŠŸèƒ½å®Œæ•´å®ç°
5. âœ… æ‰€æœ‰æµ‹è¯•ç”¨ä¾‹éƒ½èƒ½é€šè¿‡
6. âœ… ä¿®å¤äº†æ‰€æœ‰ç¼–è¯‘å’Œè¿è¡Œé”™è¯¯
7. âœ… æ²¡æœ‰ç¼ºå¤±çš„æ¨¡å—æˆ–å‡½æ•°

**é¡¹ç›®ç°åœ¨å¯ä»¥ç›´æ¥éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒä½¿ç”¨ï¼** ğŸš€
