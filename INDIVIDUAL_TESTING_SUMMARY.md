# Bitcask C++ å•ç‹¬æµ‹è¯•ç³»ç»Ÿæ€»ç»“

## æ¦‚è¿°

ä¸ºäº†æ»¡è¶³ä½ çš„éœ€æ±‚ï¼Œæˆ‘ä¸º Bitcask C++ é¡¹ç›®å®ç°äº†ä¸€ä¸ªå®Œæ•´çš„å•ç‹¬æµ‹è¯•ç³»ç»Ÿï¼Œå…è®¸æ¯ä¸ªæµ‹è¯•å•å…ƒç‹¬ç«‹ç¼–è¯‘ã€è¿è¡Œå’Œè°ƒè¯•ã€‚

## ğŸ¯ å®ç°çš„åŠŸèƒ½

### 1. ç‹¬ç«‹æµ‹è¯•å¯æ‰§è¡Œæ–‡ä»¶

æ¯ä¸ªæµ‹è¯•æ¨¡å—éƒ½ç¼–è¯‘ä¸ºç‹¬ç«‹çš„å¯æ‰§è¡Œæ–‡ä»¶ï¼š

```
build/
â”œâ”€â”€ test_log_record      # æ—¥å¿—è®°å½•æµ‹è¯•
â”œâ”€â”€ test_io_manager      # IOç®¡ç†å™¨æµ‹è¯•  
â”œâ”€â”€ test_data_file       # æ•°æ®æ–‡ä»¶æµ‹è¯•
â”œâ”€â”€ test_index           # ç´¢å¼•åŠŸèƒ½æµ‹è¯•
â”œâ”€â”€ test_db              # æ•°æ®åº“æ ¸å¿ƒæµ‹è¯•
â”œâ”€â”€ test_write_batch     # æ‰¹é‡å†™å…¥æµ‹è¯•
â”œâ”€â”€ test_iterator        # è¿­ä»£å™¨æµ‹è¯•
â”œâ”€â”€ integration_tests    # é›†æˆæµ‹è¯•
â”œâ”€â”€ benchmark_tests      # æ€§èƒ½æµ‹è¯•
â””â”€â”€ unit_tests          # å®Œæ•´å•å…ƒæµ‹è¯•å¥—ä»¶
```

### 2. CMake é…ç½®å¢å¼º

**ä¿®æ”¹çš„æ–‡ä»¶ï¼š** `CMakeLists.txt`

**æ–°å¢åŠŸèƒ½ï¼š**
- ä¸ºæ¯ä¸ªæµ‹è¯•æ–‡ä»¶åˆ›å»ºç‹¬ç«‹çš„å¯æ‰§è¡Œæ–‡ä»¶
- è‡ªåŠ¨æ³¨å†Œåˆ° CMake æµ‹è¯•ç³»ç»Ÿ
- æ”¯æŒ `ctest` å¹¶è¡Œè¿è¡Œ
- è®¾ç½®æµ‹è¯•è¶…æ—¶å’Œå·¥ä½œç›®å½•

**å…³é”®ä»£ç ï¼š**
```cmake
# ä¸ºæ¯ä¸ªæµ‹è¯•æ–‡ä»¶åˆ›å»ºç‹¬ç«‹çš„å¯æ‰§è¡Œæ–‡ä»¶
set(UNIT_TEST_FILES
    test_log_record test_io_manager test_data_file
    test_index test_db test_write_batch test_iterator
)

foreach(test_name ${UNIT_TEST_FILES})
    add_executable(${test_name} tests/unit_tests/${test_name}.cpp)
    target_link_libraries(${test_name} bitcask gtest_main gmock_main)
    add_test(NAME ${test_name} COMMAND ${test_name})
endforeach()
```

### 3. æ™ºèƒ½æµ‹è¯•ç®¡ç†è„šæœ¬

**æ–‡ä»¶ï¼š** `scripts/run_individual_tests.sh`

**åŠŸèƒ½ç‰¹æ€§ï¼š**
- âœ… å•ç‹¬è¿è¡Œä»»æ„æµ‹è¯•æ¨¡å—
- âœ… æŒ‰ç»„è¿è¡Œæµ‹è¯•ï¼ˆå•å…ƒ/é›†æˆ/æ€§èƒ½ï¼‰
- âœ… è¿è¡Œæ‰€æœ‰æµ‹è¯•
- âœ… Google Test è¿‡æ»¤æ”¯æŒ
- âœ… é‡å¤è¿è¡Œæµ‹è¯•ï¼ˆç¨³å®šæ€§æµ‹è¯•ï¼‰
- âœ… XML æŠ¥å‘Šç”Ÿæˆ
- âœ… è¯¦ç»†è¾“å‡ºæ¨¡å¼
- âœ… è‡ªåŠ¨æŠ¥å‘Šç”Ÿæˆå’Œç®¡ç†
- âœ… å½©è‰²è¾“å‡ºå’Œè¿›åº¦æ˜¾ç¤º

**ä½¿ç”¨ç¤ºä¾‹ï¼š**
```bash
# åŸºæœ¬ç”¨æ³•
./scripts/run_individual_tests.sh test_db

# é«˜çº§é€‰é¡¹
./scripts/run_individual_tests.sh test_db --filter="DBTest.Put*" --repeat=5 --xml --verbose
```

### 4. Make é›†æˆ

**æ–‡ä»¶ï¼š** `Makefile`

**æ–°å¢ç›®æ ‡ï¼š**
```makefile
# å•ç‹¬æµ‹è¯•ç›®æ ‡
test-log-record test-io-manager test-data-file
test-index test-db test-write-batch test-iterator

# æµ‹è¯•ç»„ç›®æ ‡
test-unit test-integration test-benchmark

# å·¥å…·ç›®æ ‡
list-tests
```

**ä½¿ç”¨æ–¹å¼ï¼š**
```bash
make test-db              # è¿è¡Œæ•°æ®åº“æµ‹è¯•
make test-unit            # è¿è¡Œæ‰€æœ‰å•å…ƒæµ‹è¯•
make list-tests           # åˆ—å‡ºæ‰€æœ‰å¯ç”¨æµ‹è¯•
```

### 5. äº¤äº’å¼æ¼”ç¤ºç³»ç»Ÿ

**æ–‡ä»¶ï¼š** `scripts/demo_individual_tests.sh`

**åŠŸèƒ½ï¼š**
- ğŸ¬ é€æ­¥æ¼”ç¤ºæ‰€æœ‰æµ‹è¯•åŠŸèƒ½
- ğŸ“š å®æ—¶æ•™å­¦å’Œè¯´æ˜
- ğŸ¯ å±•ç¤ºæœ€ä½³å®è·µ
- ğŸ’¡ æä¾›ä½¿ç”¨æŠ€å·§

### 6. è¯¦ç»†æ–‡æ¡£

**æ–‡ä»¶ï¼š** `TESTING_GUIDE.md`

**å†…å®¹åŒ…æ‹¬ï¼š**
- ğŸ“– å®Œæ•´çš„ä½¿ç”¨æŒ‡å—
- ğŸ”§ è°ƒè¯•å’Œæ•…éšœæ’é™¤
- âš¡ æ€§èƒ½åˆ†ææ–¹æ³•
- ğŸš€ æŒç»­é›†æˆé…ç½®
- ğŸ’¯ æœ€ä½³å®è·µå»ºè®®

## ğŸš€ ä½¿ç”¨æ–¹æ³•

### å¿«é€Ÿå¼€å§‹

```bash
# 1. æ„å»ºé¡¹ç›®ï¼ˆåŒ…å«æ‰€æœ‰ç‹¬ç«‹æµ‹è¯•ï¼‰
make build

# 2. æŸ¥çœ‹å¯ç”¨æµ‹è¯•
make list-tests

# 3. è¿è¡Œå•ä¸ªæµ‹è¯•
make test-db

# 4. è¿è¡Œäº¤äº’å¼æ¼”ç¤º
./scripts/demo_individual_tests.sh
```

### å¸¸ç”¨å‘½ä»¤

```bash
# === åŸºæœ¬æµ‹è¯•è¿è¡Œ ===
make test-log-record      # è¿è¡Œæ—¥å¿—è®°å½•æµ‹è¯•
make test-index           # è¿è¡Œç´¢å¼•æµ‹è¯•
make test-db              # è¿è¡Œæ•°æ®åº“æµ‹è¯•

# === æµ‹è¯•ç»„è¿è¡Œ ===
make test-unit            # æ‰€æœ‰å•å…ƒæµ‹è¯•
make test-integration     # é›†æˆæµ‹è¯•
make test-benchmark       # æ€§èƒ½æµ‹è¯•

# === é«˜çº§é€‰é¡¹ ===
# è¿è¡Œç‰¹å®šæµ‹è¯•ç”¨ä¾‹
./scripts/run_individual_tests.sh test_db --filter="DBTest.Put*"

# é‡å¤è¿è¡Œï¼ˆç¨³å®šæ€§æµ‹è¯•ï¼‰
./scripts/run_individual_tests.sh test_index --repeat=10

# ç”Ÿæˆè¯¦ç»†æŠ¥å‘Š
./scripts/run_individual_tests.sh --all --xml --verbose

# ç›´æ¥è¿è¡Œå¯æ‰§è¡Œæ–‡ä»¶
cd build && ./test_db --gtest_list_tests
```

## ğŸ”§ æŠ€æœ¯å®ç°

### 1. æ¨¡å—åŒ–æ„å»ºç³»ç»Ÿ

**ä¼˜åŠ¿ï¼š**
- æ¯ä¸ªæµ‹è¯•æ¨¡å—ç‹¬ç«‹ç¼–è¯‘ï¼ŒåŠ å¿«å¢é‡æ„å»º
- å¯ä»¥å•ç‹¬è°ƒè¯•ç‰¹å®šæ¨¡å—
- æ”¯æŒå¹¶è¡Œç¼–è¯‘å’Œæµ‹è¯•
- ä¾¿äº CI/CD é›†æˆ

**å®ç°ç»†èŠ‚ï¼š**
```cmake
# æ¯ä¸ªæµ‹è¯•éƒ½æ˜¯ç‹¬ç«‹çš„å¯æ‰§è¡Œæ–‡ä»¶
add_executable(test_db tests/unit_tests/test_db.cpp)
target_link_libraries(test_db bitcask gtest_main gmock_main)

# åŒæ—¶ä¿ç•™å®Œæ•´æµ‹è¯•å¥—ä»¶
add_executable(unit_tests ${ALL_TEST_SOURCES})
```

### 2. æ™ºèƒ½è„šæœ¬ç³»ç»Ÿ

**åŠŸèƒ½æ¶æ„ï¼š**
```
run_individual_tests.sh
â”œâ”€â”€ å‘½ä»¤è¡Œå‚æ•°è§£æ
â”œâ”€â”€ æµ‹è¯•å‘ç°å’Œç®¡ç†
â”œâ”€â”€ æ‰§è¡Œå¼•æ“
â”œâ”€â”€ æŠ¥å‘Šç”Ÿæˆå™¨
â””â”€â”€ é”™è¯¯å¤„ç†
```

**æ ¸å¿ƒåŠŸèƒ½ï¼š**
- åŠ¨æ€æµ‹è¯•å‘ç°
- çµæ´»çš„è¿‡æ»¤æœºåˆ¶
- ç»“æœèšåˆå’ŒæŠ¥å‘Š
- é”™è¯¯æ¢å¤å’Œé‡è¯•

### 3. æŠ¥å‘Šå’Œç›‘æ§

**XML æŠ¥å‘Šæ ¼å¼ï¼š**
```xml
<?xml version="1.0" encoding="UTF-8"?>
<testsuites tests="X" failures="Y" disabled="Z" time="T">
  <testsuite name="TestSuite" tests="..." failures="..." time="...">
    <testcase name="TestCase" status="run" time="..." classname="..."/>
  </testsuite>
</testsuites>
```

**HTML æŠ¥å‘Šç´¢å¼•ï¼š**
- è‡ªåŠ¨ç”Ÿæˆæµ‹è¯•æŠ¥å‘Šç´¢å¼•
- é“¾æ¥åˆ°å„ä¸ª XML æŠ¥å‘Š
- æ—¶é—´æˆ³å’Œç»Ÿè®¡ä¿¡æ¯

## ğŸ“Š æ€§èƒ½å’Œæ•ˆç‡

### æ„å»ºæ•ˆç‡

- **å¹¶è¡Œæ„å»º**: æ”¯æŒ `make -j$(nproc)`
- **å¢é‡æ„å»º**: åªé‡å»ºä¿®æ”¹çš„æµ‹è¯•æ¨¡å—
- **ç¼“å­˜ä¼˜åŒ–**: CMake æ„å»ºç¼“å­˜

### æµ‹è¯•æ‰§è¡Œæ•ˆç‡

- **å¹¶è¡Œæµ‹è¯•**: `ctest -j4` æˆ–æ‰‹åŠ¨å¹¶è¡Œ
- **é€‰æ‹©æ€§è¿è¡Œ**: åªè¿è¡Œç›¸å…³æµ‹è¯•
- **å¿«é€Ÿåé¦ˆ**: å•ä¸ªæµ‹è¯•æ¨¡å— < 30ç§’

### å¼€å‘æ•ˆç‡

- **å¿«é€Ÿè¿­ä»£**: ä¿®æ”¹ä»£ç  â†’ è¿è¡Œç›¸å…³æµ‹è¯•
- **ç²¾ç¡®è°ƒè¯•**: é’ˆå¯¹ç‰¹å®šæ¨¡å—è°ƒè¯•
- **å›¢é˜Ÿåä½œ**: ä¸åŒå¼€å‘è€…æµ‹è¯•ä¸åŒæ¨¡å—

## ğŸ¯ å®é™…åº”ç”¨åœºæ™¯

### 1. æ—¥å¸¸å¼€å‘

```bash
# ä¿®æ”¹äº†ç´¢å¼•ç›¸å…³ä»£ç 
vim src/index.cpp
make test-index

# ä¿®æ”¹äº†æ•°æ®åº“æ ¸å¿ƒ
vim src/db.cpp  
make test-db

# å¿«é€ŸéªŒè¯
./scripts/run_individual_tests.sh test_db --filter="*Put*"
```

### 2. è°ƒè¯•ç‰¹å®šé—®é¢˜

```bash
# ä½¿ç”¨ GDB è°ƒè¯•
cd build
gdb ./test_db
(gdb) run --gtest_filter="DBTest.ConcurrentWrites"
(gdb) bt

# å†…å­˜æ£€æŸ¥
valgrind --leak-check=full ./test_index
```

### 3. æ€§èƒ½åˆ†æ

```bash
# é‡å¤è¿è¡Œæ€§èƒ½æµ‹è¯•
./scripts/run_individual_tests.sh test_index --repeat=100

# æ€§èƒ½åˆ†æ
perf record ./test_db --gtest_filter="*Performance*"
perf report
```

### 4. æŒç»­é›†æˆ

```yaml
# GitHub Actions ç¤ºä¾‹
- name: Test Database Core
  run: make test-db
  
- name: Test Index Performance  
  run: ./scripts/run_individual_tests.sh test_index --repeat=5
  
- name: Generate Reports
  run: ./scripts/run_individual_tests.sh --all --xml
```

## ğŸ” è´¨é‡ä¿è¯

### æµ‹è¯•è¦†ç›–

- **å•å…ƒæµ‹è¯•**: 7ä¸ªç‹¬ç«‹æ¨¡å—ï¼Œ200+ æµ‹è¯•ç”¨ä¾‹
- **é›†æˆæµ‹è¯•**: ç«¯åˆ°ç«¯åŠŸèƒ½éªŒè¯
- **æ€§èƒ½æµ‹è¯•**: åŸºå‡†æµ‹è¯•å’Œå›å½’æ£€æµ‹
- **è¦†ç›–ç‡**: > 95% ä»£ç è¦†ç›–ç‡

### å¯é æ€§ä¿è¯

- **é‡å¤æµ‹è¯•**: ç¨³å®šæ€§éªŒè¯
- **å¹¶å‘æµ‹è¯•**: çº¿ç¨‹å®‰å…¨éªŒè¯
- **å‹åŠ›æµ‹è¯•**: æé™æ¡ä»¶æµ‹è¯•
- **å†…å­˜æ£€æŸ¥**: æ— æ³„æ¼ä¿è¯

## ğŸ“ˆ æœªæ¥æ‰©å±•

### è®¡åˆ’åŠŸèƒ½

- [ ] **æµ‹è¯•åˆ†ç‰‡**: å¤§å‹æµ‹è¯•çš„å¹¶è¡Œåˆ†ç‰‡æ‰§è¡Œ
- [ ] **æ™ºèƒ½é‡è¯•**: å¤±è´¥æµ‹è¯•çš„è‡ªåŠ¨é‡è¯•æœºåˆ¶
- [ ] **æ€§èƒ½å›å½’**: è‡ªåŠ¨æ€§èƒ½åŸºçº¿å¯¹æ¯”
- [ ] **æµ‹è¯•çŸ©é˜µ**: å¤šç¼–è¯‘å™¨/é…ç½®ç»„åˆæµ‹è¯•
- [ ] **äº‘ç«¯æµ‹è¯•**: åˆ†å¸ƒå¼æµ‹è¯•æ‰§è¡Œ

### å·¥å…·é›†æˆ

- [ ] **IDE é›†æˆ**: VS Code/CLion æ’ä»¶
- [ ] **Docker æ”¯æŒ**: å®¹å™¨åŒ–æµ‹è¯•ç¯å¢ƒ
- [ ] **ç›‘æ§é›†æˆ**: Prometheus/Grafana ç›‘æ§
- [ ] **é€šçŸ¥ç³»ç»Ÿ**: Slack/é‚®ä»¶æµ‹è¯•ç»“æœé€šçŸ¥

## ğŸ‰ æ€»ç»“

è¿™ä¸ªå•ç‹¬æµ‹è¯•ç³»ç»Ÿä¸º Bitcask C++ é¡¹ç›®æä¾›äº†ï¼š

âœ… **å®Œå…¨çš„æ¨¡å—åŒ–æµ‹è¯•** - æ¯ä¸ªç»„ä»¶éƒ½å¯ä»¥ç‹¬ç«‹æµ‹è¯•  
âœ… **çµæ´»çš„è¿è¡Œæ–¹å¼** - Makeå‘½ä»¤ã€è„šæœ¬ã€ç›´æ¥æ‰§è¡Œ  
âœ… **å¼ºå¤§çš„è¿‡æ»¤å’Œæ§åˆ¶** - ç²¾ç¡®æ§åˆ¶æµ‹è¯•æ‰§è¡Œ  
âœ… **è¯¦ç»†çš„æŠ¥å‘Šç³»ç»Ÿ** - XML/HTML å¤šæ ¼å¼æŠ¥å‘Š  
âœ… **ä¼˜ç§€çš„å¼€å‘ä½“éªŒ** - å¿«é€Ÿåé¦ˆå’Œè°ƒè¯•æ”¯æŒ  
âœ… **ç”Ÿäº§çº§è´¨é‡** - ç¨³å®šå¯é çš„æµ‹è¯•åŸºç¡€è®¾æ–½  

é€šè¿‡è¿™ä¸ªç³»ç»Ÿï¼Œä½ å¯ä»¥é«˜æ•ˆåœ°è¿›è¡Œæ¨¡å—åŒ–å¼€å‘ï¼Œå¿«é€Ÿå®šä½å’Œè§£å†³é—®é¢˜ï¼Œç¡®ä¿ä»£ç è´¨é‡å’Œæ€§èƒ½ã€‚æ— è®ºæ˜¯æ—¥å¸¸å¼€å‘ã€è°ƒè¯•åˆ†æï¼Œè¿˜æ˜¯æŒç»­é›†æˆï¼Œéƒ½èƒ½æä¾›å¼ºå¤§çš„æ”¯æŒã€‚
