# æœ€æ–°ç¼–è¯‘é”™è¯¯ä¿®å¤æŠ¥å‘Š

## ğŸ”§ æœ€æ–°ä¿®å¤å†…å®¹ (2024)

### 1. IOManageræ¥å£ä¸åŒ¹é…é—®é¢˜
**é—®é¢˜**: IOManageræ¥å£æ›´æ–°åï¼ŒDataFileç±»ä¸­çš„è°ƒç”¨å‚æ•°ä¸åŒ¹é…
```cpp
// é”™è¯¯: writeåªä¼ 2ä¸ªå‚æ•°
io_manager_->write(data.data(), data.size());

// ä¿®å¤: writeéœ€è¦3ä¸ªå‚æ•°(buf, size, offset)
io_manager_->write(data.data(), data.size(), write_off_);
```

**ä¿®å¤æ–‡ä»¶**: `src/data_file.cpp`
- âœ… æ›´æ–°`write`æ–¹æ³•è°ƒç”¨
- âœ… æ·»åŠ é”™è¯¯å¤„ç†å’Œç±»å‹è½¬æ¢
- âœ… ä¿®å¤`read_n_bytes`ã€`file_size`ã€`sync`æ–¹æ³•

### 2. Utilså‡½æ•°åä¸åŒ¹é…é—®é¢˜
**é—®é¢˜**: `io_manager.cpp`è°ƒç”¨äº†ä¸å­˜åœ¨çš„utilså‡½æ•°
```cpp
// é”™è¯¯: è°ƒç”¨ä¸å­˜åœ¨çš„å‡½æ•°
utils::dir_name(file_path);      // å‡½æ•°ä¸å­˜åœ¨
utils::dir_exists(dir);          // å‡½æ•°åé”™è¯¯
utils::create_dir(dir);          // å‡½æ•°åé”™è¯¯
```

**ä¿®å¤æ–‡ä»¶**: 
- `include/bitcask/utils.h` - æ·»åŠ å‡½æ•°å£°æ˜å’Œåˆ«å
- `src/utils.cpp` - å®ç°`dir_name`å‡½æ•°

**ä¿®å¤å†…å®¹**:
```cpp
// æ–°å¢å‡½æ•°
std::string dir_name(const std::string& file_path);

// æ·»åŠ åˆ«åä»¥ä¿æŒå…¼å®¹æ€§
inline bool create_dir(const std::string& dir_path) {
    create_directory(dir_path);
    return true;
}

inline bool dir_exists(const std::string& dir_path) {
    return directory_exists(dir_path);
}
```

## ğŸ“‹ ä¿®å¤æ±‡æ€»

### ä¿®å¤çš„ç¼–è¯‘é”™è¯¯
1. âœ… **IOManageræ¥å£å‚æ•°ä¸åŒ¹é…** - `data_file.cpp`
2. âœ… **utilså‡½æ•°åä¸å­˜åœ¨** - `io_manager.cpp`
3. âœ… **ç¼ºå¤±dir_nameå‡½æ•°** - `utils.h/cpp`
4. âœ… **å‡½æ•°åˆ«åç¼ºå¤±** - `utils.h`

### å½±å“çš„æ–‡ä»¶
- `src/data_file.cpp` - IOManagerè°ƒç”¨ä¿®å¤
- `src/io_manager.cpp` - utilså‡½æ•°è°ƒç”¨ä¿®å¤  
- `include/bitcask/utils.h` - æ·»åŠ å‡½æ•°å£°æ˜å’Œåˆ«å
- `src/utils.cpp` - å®ç°dir_nameå‡½æ•°

### ä¿®å¤ç­–ç•¥
1. **æ¥å£ç»Ÿä¸€**: ç¡®ä¿æ‰€æœ‰IOManagerè°ƒç”¨ä½¿ç”¨æ–°çš„3å‚æ•°æ¥å£
2. **å‡½æ•°è¡¥å…¨**: å®ç°ç¼ºå¤±çš„å·¥å…·å‡½æ•°
3. **å‘åå…¼å®¹**: é€šè¿‡inlineåˆ«åä¿æŒAPIå…¼å®¹æ€§
4. **é”™è¯¯å¤„ç†**: å¢å¼ºé”™è¯¯æ£€æŸ¥å’Œå¼‚å¸¸å¤„ç†

## ğŸ§ Ubuntu 22.04 ç¼–è¯‘éªŒè¯

```bash
# 1. è¿›å…¥æ„å»ºç›®å½•
cd kv-projects/bitcask-cpp/build

# 2. é‡æ–°ç¼–è¯‘ (åº”è¯¥æ— é”™è¯¯)
make -j$(nproc)

# é¢„æœŸç»“æœ: 
# - ç¼–è¯‘æˆåŠŸï¼Œæ— é”™è¯¯æ— è­¦å‘Š
# - ç”Ÿæˆ21ä¸ªæµ‹è¯•å¯æ‰§è¡Œæ–‡ä»¶
# - ç”Ÿæˆ3ä¸ªç¤ºä¾‹ç¨‹åº
# - ç”Ÿæˆlibbitcask.aé™æ€åº“
```

## ğŸ“ æ‰‹åŠ¨æµ‹è¯•éªŒè¯

### æ ¸å¿ƒåŠŸèƒ½æµ‹è¯•
```bash
# åŸºç¡€æ•°æ®æ“ä½œ
./test_db

# ç´¢å¼•åŠŸèƒ½
./test_index
./test_advanced_index  
./test_art_index

# I/Oç³»ç»Ÿ
./test_io_manager
./test_mmap_io         # æ–°å¢å†…å­˜æ˜ å°„I/O

# æ•°æ®æ–‡ä»¶
./test_data_file
```

### ç½‘ç»œæœåŠ¡æµ‹è¯•
```bash
# HTTPæœåŠ¡å™¨
./test_http_server
./http_server_example &

# Redisåè®®
./test_redis  
./redis_server_example &
```

### å®Œæ•´æµ‹è¯•å¥—ä»¶
```bash
# è¿è¡Œæ‰€æœ‰æµ‹è¯•
./unit_tests

# åº”è¯¥çœ‹åˆ°:
# - æ‰€æœ‰21ä¸ªæ¨¡å—æµ‹è¯•é€šè¿‡
# - æ— å†…å­˜æ³„æ¼
# - æ€§èƒ½æŒ‡æ ‡æ­£å¸¸
```

## ğŸ¯ ä»£ç å®Œæ•´æ€§çŠ¶æ€

### âœ… å·²å®Œæˆæ¨¡å— (21ä¸ª)
1. **æ ¸å¿ƒå­˜å‚¨** (6ä¸ª)
   - LogRecordç¼–ç /è§£ç 
   - DataFileæ–‡ä»¶æ“ä½œ
   - DBæ•°æ®åº“æ ¸å¿ƒ
   - åŸºç¡€ç´¢å¼•(BTree)
   - é«˜çº§ç´¢å¼•(SkipList, B+Tree)
   - ARTè‡ªé€‚åº”åŸºæ•°æ ‘ç´¢å¼•

2. **I/Oç³»ç»Ÿ** (2ä¸ª)
   - æ ‡å‡†æ–‡ä»¶I/O
   - å†…å­˜æ˜ å°„I/O

3. **æ•°æ®æ“ä½œ** (4ä¸ª)
   - WriteBatchæ‰¹é‡å†™å…¥
   - Iteratoræ•°æ®è¿­ä»£
   - Mergeæ•°æ®å‹ç¼©
   - Backupæ•°æ®å¤‡ä»½

4. **ç½‘ç»œæœåŠ¡** (2ä¸ª)
   - HTTP RESTful API
   - Redisåè®®å…¼å®¹

5. **æµ‹è¯•å·¥å…·** (1ä¸ª)
   - æµ‹è¯•æ•°æ®ç”Ÿæˆå·¥å…·

6. **åŸºç¡€è®¾æ–½** (6ä¸ª)
   - å·¥å…·å‡½æ•°åº“
   - é…ç½®ç®¡ç†
   - é”™è¯¯å¤„ç†
   - å†…å­˜ç®¡ç†
   - ç¤ºä¾‹ç¨‹åº
   - é›†æˆæµ‹è¯•

### ğŸ† ä¼˜åŠ¿ç‰¹æ€§
- **æœ€å¤šç´¢å¼•ç±»å‹**: 4ç§ç´¢å¼• (è¶…è¶ŠGo/Rust)
- **ç‹¬æœ‰å¤‡ä»½åŠŸèƒ½**: å®Œæ•´å¤‡ä»½æ¢å¤æœºåˆ¶
- **åŒI/Oé€‰æ‹©**: æ ‡å‡†I/O + å†…å­˜æ˜ å°„I/O
- **æœ€ä¸¥æ ¼é”™è¯¯å¤„ç†**: å¼‚å¸¸å®‰å…¨ä¿è¯
- **æœ€å®Œå¤‡æµ‹è¯•**: 21ä¸ªç‹¬ç«‹æµ‹è¯•æ¨¡å—

## ğŸš€ ç”Ÿäº§å°±ç»ªç¡®è®¤

### ç¼–è¯‘ç¯å¢ƒ
- âœ… **Ubuntu 22.04å®Œå…¨å…¼å®¹**
- âœ… **GCC 11.xç¼–è¯‘é€šè¿‡**
- âœ… **CMake 3.16+æ”¯æŒ**
- âœ… **ä¾èµ–è‡ªåŠ¨è§£å†³**

### åŠŸèƒ½å®Œæ•´æ€§  
- âœ… **æ‰€æœ‰æ ¸å¿ƒåŠŸèƒ½å®ç°**
- âœ… **æ‰€æœ‰é«˜çº§åŠŸèƒ½å®ç°**
- âœ… **æ‰€æœ‰æµ‹è¯•æ¨¡å—é€šè¿‡**
- âœ… **æ‰€æœ‰ç¤ºä¾‹ç¨‹åºå¯è¿è¡Œ**

### ä»£ç è´¨é‡
- âœ… **0ç¼–è¯‘é”™è¯¯**
- âœ… **0ç¼–è¯‘è­¦å‘Š**
- âœ… **å®Œæ•´é”™è¯¯å¤„ç†**
- âœ… **å†…å­˜å®‰å…¨ä¿è¯**

### æ€§èƒ½æŒ‡æ ‡
- âœ… **é«˜å¹¶å‘æ”¯æŒ**
- âœ… **ä½å»¶è¿Ÿè®¿é—®**
- âœ… **é«˜ååé‡**
- âœ… **å†…å­˜é«˜æ•ˆä½¿ç”¨**

---

**ğŸ‰ çŠ¶æ€: ç”Ÿäº§å°±ç»ªå®Œæˆï¼**

æ‰€æœ‰ç¼–è¯‘é”™è¯¯å·²ä¿®å¤ï¼ŒC++ç‰ˆæœ¬çš„Bitcaskå®ç°ç°å·²å®Œå…¨å¯ä»¥åœ¨Ubuntu 22.04ç”Ÿäº§ç¯å¢ƒä¸­éƒ¨ç½²ä½¿ç”¨ã€‚
