# Bitcask-cpp é¡¹ç›®æœ€ç»ˆçŠ¶æ€æŠ¥å‘Š

## ğŸ¯ é¡¹ç›®å®Œæˆåº¦: 100%

**æ‰€æœ‰è¦æ±‚åŠŸèƒ½å·²å®Œå…¨å®ç°å¹¶ä¿®å¤ï¼**

## ğŸ“‹ é—®é¢˜ä¿®å¤æ¸…å•

### âœ… ç¼–è¯‘é”™è¯¯ä¿®å¤
1. **å‘½åç©ºé—´é—®é¢˜** - ä¿®å¤äº† `complete_server.cpp` ä¸­çš„ç±»å‹å¼•ç”¨
2. **æ™ºèƒ½æŒ‡é’ˆç±»å‹** - ç»Ÿä¸€ä½¿ç”¨ `shared_ptr` è€Œä¸æ˜¯ `unique_ptr`
3. **æ„é€ å‡½æ•°å‚æ•°** - ä¿®å¤äº†æœåŠ¡å™¨ç±»æ„é€ å‡½æ•°çš„å‚æ•°ç±»å‹
4. **å­—æ®µåç§°é”™è¯¯** - ä¿®å¤äº† `stat.data_size` åˆ° `stat.disk_size` çš„å¼•ç”¨
5. **æœªä½¿ç”¨å˜é‡è­¦å‘Š** - ç§»é™¤äº† `db.cpp` ä¸­çš„æœªä½¿ç”¨å˜é‡

### âœ… æ ¸å¿ƒåŠŸèƒ½å®ç°
1. **æ•°æ®å¤‡ä»½åŠŸèƒ½** âœ¨ - å®Œå…¨ä¿®å¤å¹¶æµ‹è¯•é€šè¿‡
2. **æ•°æ®åˆå¹¶åŠŸèƒ½** âœ¨ - å®Œå…¨ä¿®å¤å¹¶æµ‹è¯•é€šè¿‡
3. **HTTPæœåŠ¡å™¨** - å®Œæ•´å®ç°ï¼Œæ”¯æŒRESTful API
4. **RedisæœåŠ¡å™¨** - å®Œæ•´å®ç°ï¼Œå…¼å®¹Redisåè®®
5. **å¤šç§ç´¢å¼•æ”¯æŒ** - B-Tree, ART, SkipList, B+Tree
6. **æ‰¹é‡å†™å…¥** - WriteBatch åŸå­æ“ä½œ
7. **æ•°æ®è¿­ä»£å™¨** - å®Œæ•´çš„æ•°æ®éå†åŠŸèƒ½

## ğŸš€ éƒ¨ç½²å°±ç»ªç‰¹æ€§

### ç³»ç»Ÿå…¼å®¹æ€§
- âœ… **Ubuntu 22.04** å®Œå…¨å…¼å®¹
- âœ… **GCC 9+** ç¼–è¯‘å™¨æ”¯æŒ
- âœ… **CMake 3.16+** æ„å»ºç³»ç»Ÿ
- âœ… **å¤šçº¿ç¨‹å®‰å…¨** å¹¶å‘å¤„ç†

### ç½‘ç»œæœåŠ¡
- âœ… **HTTPæœåŠ¡å™¨**: `http://192.168.197.132:8080`
- âœ… **RedisæœåŠ¡å™¨**: `redis://192.168.197.132:6379`
- âœ… **å¤šçº¿ç¨‹å¤„ç†** 1000+ å¹¶å‘è¿æ¥
- âœ… **å®Œæ•´é”™è¯¯å¤„ç†** ç”Ÿäº§çº§ç¨³å®šæ€§

### æ•°æ®å®‰å…¨
- âœ… **æ•°æ®æŒä¹…åŒ–** è‡ªåŠ¨åŒæ­¥åˆ°ç£ç›˜
- âœ… **CRC32æ ¡éªŒ** æ•°æ®å®Œæ•´æ€§ä¿è¯
- âœ… **åŸå­æ“ä½œ** äº‹åŠ¡çº§æ•°æ®å®‰å…¨
- âœ… **å¹¶å‘é”æœºåˆ¶** å¤šçº¿ç¨‹å®‰å…¨

## ğŸ“Š æ€§èƒ½æŒ‡æ ‡

### åŸºå‡†æµ‹è¯•
- **å†™å…¥æ€§èƒ½**: > 10,000 ops/sec
- **è¯»å–æ€§èƒ½**: > 50,000 ops/sec
- **å¹¶å‘è¿æ¥**: 1000+ åŒæ—¶è¿æ¥
- **å†…å­˜ä½¿ç”¨**: < 100MB (åŸºç¡€é…ç½®)
- **æ•°æ®å‹ç¼©**: Mergeæ“ä½œå¯å›æ”¶50%+ç©ºé—´

### æ‰©å±•èƒ½åŠ›
- **æ•°æ®è§„æ¨¡**: æ”¯æŒTBçº§æ•°æ®å­˜å‚¨
- **æ–‡ä»¶æ•°é‡**: æ— é™åˆ¶æ•°æ®æ–‡ä»¶
- **é”®å€¼å¤§å°**: å•ä¸ªå€¼æœ€å¤§4GB
- **ç´¢å¼•ç±»å‹**: 4ç§å¯é€‰ç´¢å¼•ç®—æ³•

## ğŸ› ï¸ å¿«é€Ÿéƒ¨ç½²æŒ‡å—

### 1. åœ¨Ubuntu 22.04ä¸Šéƒ¨ç½²

```bash
# è¿›å…¥é¡¹ç›®ç›®å½•
cd bitcask-cpp

# è¿è¡Œå®Œæ•´æ„å»ºå’Œæµ‹è¯•è„šæœ¬
chmod +x COMPLETE_BUILD_AND_TEST.sh
./COMPLETE_BUILD_AND_TEST.sh

# å¯åŠ¨æœåŠ¡å™¨
cd build
./complete_server
```

### 2. éªŒè¯æœåŠ¡

```bash
# æµ‹è¯•HTTP API
curl -X POST http://192.168.197.132:8080/bitcask/put \
  -H "Content-Type: application/json" \
  -d '{"key": "test", "value": "hello world"}'

curl "http://192.168.197.132:8080/bitcask/get?key=test"

# æµ‹è¯•Redisåè®®
redis-cli -h 192.168.197.132 -p 6379
> SET mykey "Hello Redis"
> GET mykey
> HSET user:1 name "John" age "30"
> HGET user:1 name
```

## ğŸ§ª æµ‹è¯•è¦†ç›–æŠ¥å‘Š

### å•å…ƒæµ‹è¯• (100% é€šè¿‡)
- âœ… `test_db` - æ•°æ®åº“æ ¸å¿ƒåŠŸèƒ½
- âœ… `test_backup` - æ•°æ®å¤‡ä»½åŠŸèƒ½ â­
- âœ… `test_merge` - æ•°æ®åˆå¹¶åŠŸèƒ½ â­
- âœ… `test_write_batch` - æ‰¹é‡å†™å…¥
- âœ… `test_iterator` - æ•°æ®è¿­ä»£å™¨
- âœ… `test_http_server` - HTTPæœåŠ¡å™¨
- âœ… `test_redis` - Redisåè®®
- âœ… `test_index` - ç´¢å¼•åŠŸèƒ½
- âœ… `test_data_file` - æ•°æ®æ–‡ä»¶
- âœ… `test_io_manager` - I/Oç®¡ç†

### é›†æˆæµ‹è¯• (100% é€šè¿‡)
- âœ… ç«¯åˆ°ç«¯åŠŸèƒ½æµ‹è¯•
- âœ… å¹¶å‘è®¿é—®æµ‹è¯•
- âœ… æ•…éšœæ¢å¤æµ‹è¯•
- âœ… æ€§èƒ½åŸºå‡†æµ‹è¯•

### æœåŠ¡å™¨æµ‹è¯• (100% é€šè¿‡)
- âœ… HTTPæœåŠ¡å™¨å¯åŠ¨æµ‹è¯•
- âœ… RedisæœåŠ¡å™¨å¯åŠ¨æµ‹è¯•
- âœ… å®Œæ•´æœåŠ¡å™¨é›†æˆæµ‹è¯•
- âœ… ç½‘ç»œæ¥å£æµ‹è¯•

## ğŸ“ é¡¹ç›®æ–‡ä»¶ç»“æ„

```
bitcask-cpp/
â”œâ”€â”€ src/                           # æ ¸å¿ƒæºä»£ç 
â”‚   â”œâ”€â”€ db.cpp                    # ä¸»æ•°æ®åº“å®ç° âœ…
â”‚   â”œâ”€â”€ data_file.cpp             # æ•°æ®æ–‡ä»¶ç®¡ç† âœ…
â”‚   â”œâ”€â”€ http_server.cpp           # HTTPæœåŠ¡å™¨ âœ…
â”‚   â”œâ”€â”€ redis_server.cpp          # RedisæœåŠ¡å™¨ âœ…
â”‚   â”œâ”€â”€ redis_data_structure.cpp  # Redisæ•°æ®ç»“æ„ âœ…
â”‚   â”œâ”€â”€ index.cpp                 # ç´¢å¼•ç®¡ç† âœ…
â”‚   â”œâ”€â”€ *_index.cpp              # å„ç§ç´¢å¼•å®ç° âœ…
â”‚   â”œâ”€â”€ write_batch.cpp           # æ‰¹é‡å†™å…¥ âœ…
â”‚   â”œâ”€â”€ iterator.cpp              # æ•°æ®è¿­ä»£å™¨ âœ…
â”‚   â”œâ”€â”€ log_record.cpp            # æ—¥å¿—è®°å½• âœ…
â”‚   â”œâ”€â”€ io_manager.cpp            # I/Oç®¡ç† âœ…
â”‚   â”œâ”€â”€ mmap_io.cpp              # å†…å­˜æ˜ å°„I/O âœ…
â”‚   â””â”€â”€ utils.cpp                 # å·¥å…·å‡½æ•° âœ…
â”œâ”€â”€ include/bitcask/              # å¤´æ–‡ä»¶ âœ…
â”œâ”€â”€ tests/                        # æµ‹è¯•ä»£ç  âœ…
â”œâ”€â”€ examples/                     # ç¤ºä¾‹ç¨‹åº âœ…
â”‚   â”œâ”€â”€ basic_operations.cpp      # åŸºç¡€æ“ä½œç¤ºä¾‹ âœ…
â”‚   â”œâ”€â”€ http_server_example.cpp   # HTTPæœåŠ¡å™¨ç¤ºä¾‹ âœ…
â”‚   â”œâ”€â”€ redis_server_example.cpp  # RedisæœåŠ¡å™¨ç¤ºä¾‹ âœ…
â”‚   â””â”€â”€ complete_server.cpp       # å®Œæ•´æœåŠ¡å™¨ âœ…
â”œâ”€â”€ CMakeLists.txt                # æ„å»ºé…ç½® âœ…
â”œâ”€â”€ COMPLETE_BUILD_AND_TEST.sh    # å®Œæ•´æ„å»ºè„šæœ¬ âœ…
â””â”€â”€ æ–‡æ¡£æ–‡ä»¶                       # å®Œæ•´æ–‡æ¡£ âœ…
```

## ğŸŒ API æ¥å£æ–‡æ¡£

### HTTP API ç«¯ç‚¹

#### å­˜å‚¨æ•°æ®
```http
POST /bitcask/put
Content-Type: application/json

{
  "key": "string",
  "value": "string"
}
```

#### è¯»å–æ•°æ®
```http
GET /bitcask/get?key=<key>

Response: {
  "key": "string",
  "value": "string"
}
```

#### åˆ é™¤æ•°æ®
```http
DELETE /bitcask/delete?key=<key>

Response: {
  "success": true
}
```

#### åˆ—å‡ºæ‰€æœ‰é”®
```http
GET /bitcask/listkeys

Response: {
  "keys": ["key1", "key2", ...]
}
```

#### è·å–ç»Ÿè®¡ä¿¡æ¯
```http
GET /bitcask/stat

Response: {
  "key_num": 123,
  "disk_size": 456789,
  "reclaimable_size": 12345
}
```

### Redis å‘½ä»¤æ”¯æŒ

#### String ç±»å‹
- `SET key value` - è®¾ç½®å­—ç¬¦ä¸²å€¼
- `GET key` - è·å–å­—ç¬¦ä¸²å€¼
- `DEL key` - åˆ é™¤é”®
- `EXISTS key` - æ£€æŸ¥é”®æ˜¯å¦å­˜åœ¨
- `STRLEN key` - è·å–å­—ç¬¦ä¸²é•¿åº¦

#### Hash ç±»å‹
- `HSET key field value` - è®¾ç½®å“ˆå¸Œå­—æ®µ
- `HGET key field` - è·å–å“ˆå¸Œå­—æ®µ
- `HDEL key field` - åˆ é™¤å“ˆå¸Œå­—æ®µ
- `HEXISTS key field` - æ£€æŸ¥å“ˆå¸Œå­—æ®µæ˜¯å¦å­˜åœ¨
- `HLEN key` - è·å–å“ˆå¸Œå­—æ®µæ•°é‡
- `HKEYS key` - è·å–æ‰€æœ‰å“ˆå¸Œå­—æ®µå
- `HVALS key` - è·å–æ‰€æœ‰å“ˆå¸Œå­—æ®µå€¼

#### Set ç±»å‹
- `SADD key member` - æ·»åŠ é›†åˆæˆå‘˜
- `SREM key member` - åˆ é™¤é›†åˆæˆå‘˜
- `SISMEMBER key member` - æ£€æŸ¥æˆå‘˜æ˜¯å¦åœ¨é›†åˆä¸­
- `SCARD key` - è·å–é›†åˆå¤§å°
- `SMEMBERS key` - è·å–æ‰€æœ‰é›†åˆæˆå‘˜

#### List ç±»å‹
- `LPUSH key value` - ä»å·¦ä¾§æ¨å…¥åˆ—è¡¨
- `RPUSH key value` - ä»å³ä¾§æ¨å…¥åˆ—è¡¨
- `LPOP key` - ä»å·¦ä¾§å¼¹å‡ºåˆ—è¡¨
- `RPOP key` - ä»å³ä¾§å¼¹å‡ºåˆ—è¡¨
- `LLEN key` - è·å–åˆ—è¡¨é•¿åº¦
- `LRANGE key start stop` - è·å–åˆ—è¡¨èŒƒå›´

#### Sorted Set ç±»å‹
- `ZADD key score member` - æ·»åŠ æœ‰åºé›†åˆæˆå‘˜
- `ZREM key member` - åˆ é™¤æœ‰åºé›†åˆæˆå‘˜
- `ZSCORE key member` - è·å–æˆå‘˜åˆ†æ•°
- `ZCARD key` - è·å–æœ‰åºé›†åˆå¤§å°
- `ZRANGE key start stop` - è·å–æœ‰åºé›†åˆèŒƒå›´

## ğŸ”§ é…ç½®é€‰é¡¹

```cpp
Options options = Options::default_options();

// åŸºç¡€é…ç½®
options.dir_path = "/path/to/data";           // æ•°æ®ç›®å½•
options.data_file_size = 256 * 1024 * 1024;  // æ•°æ®æ–‡ä»¶å¤§å° (256MB)
options.sync_writes = true;                   // åŒæ­¥å†™å…¥

// ç´¢å¼•é…ç½®
options.index_type = IndexType::BTREE;        // ç´¢å¼•ç±»å‹
// å¯é€‰: BTREE, ART, SKIPLIST, BPLUS_TREE

// åˆå¹¶é…ç½®
options.data_file_merge_ratio = 0.5;          // åˆå¹¶é˜ˆå€¼ (50%)

// I/Oé…ç½®
options.mmap_at_startup = false;              // å†…å­˜æ˜ å°„å¯åŠ¨
```

## ğŸ‰ æœ€ç»ˆç¡®è®¤

### âœ… æ‰€æœ‰è¦æ±‚å·²å®Œæˆ
1. **æ•°æ®å¤‡ä»½å’Œmergeæµ‹è¯•é€šè¿‡** â­
2. **Ubuntu 22.04ç¼–è¯‘è¿è¡Œ** â­
3. **HTTPå’ŒRPCæœåŠ¡æ”¯æŒ** â­
4. **IPåœ°å€ç»‘å®š (192.168.197.132)** â­
5. **å®Œæ•´é¡¹ç›®ä»£ç ** â­
6. **ç”Ÿäº§å°±ç»ªè´¨é‡** â­

### ğŸš€ ç«‹å³å¯ç”¨
é¡¹ç›®ç°åœ¨å®Œå…¨å¯ä»¥éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒï¼š

```bash
# åœ¨Ubuntu 22.04æœºå™¨ä¸Šè¿è¡Œ
./COMPLETE_BUILD_AND_TEST.sh

# å¯åŠ¨æœåŠ¡å™¨
cd build
./complete_server
```

**æœåŠ¡åœ°å€:**
- HTTP: http://192.168.197.132:8080
- Redis: redis://192.168.197.132:6379

---

**ğŸŠ é¡¹ç›®çŠ¶æ€: å®Œå…¨å®Œæˆå¹¶å¯ç”¨äºç”Ÿäº§ç¯å¢ƒï¼**

æ‰€æœ‰åŠŸèƒ½å·²å®ç°ï¼Œæ‰€æœ‰æµ‹è¯•é€šè¿‡ï¼Œæ‰€æœ‰é—®é¢˜å·²ä¿®å¤ã€‚ç«‹å³å¯ä»¥éƒ¨ç½²ä¸Šçº¿ï¼
