# æœ€ç»ˆæµ‹è¯•éªŒè¯æŒ‡å—

## ğŸ¯ å…³é”®ä¿®å¤æ€»ç»“

### 1. ä¿®å¤mergeåç´¢å¼•é‡å»ºé—®é¢˜
**æ–‡ä»¶**: `src/db.cpp`
**é—®é¢˜**: mergeåçš„æ–‡ä»¶è¢«é”™è¯¯è·³è¿‡ï¼Œå¯¼è‡´ç´¢å¼•é‡å»ºå¤±è´¥
**ä¿®å¤**: 
- ä¿®æ”¹äº†`load_index_from_data_files()`ä¸­çš„mergeæ–‡ä»¶å¤„ç†é€»è¾‘
- ç¡®ä¿mergeåçš„æ‰€æœ‰æ–‡ä»¶éƒ½è¢«æ­£ç¡®å¤„ç†ï¼Œä¸è·³è¿‡ä»»ä½•æ–‡ä»¶

### 2. ä¿®å¤backupæ´»è·ƒæ–‡ä»¶å¤„ç†
**æ–‡ä»¶**: `src/db.cpp`
**é—®é¢˜**: å½“`file_ids_`ä¸ºç©ºä½†æœ‰æ´»è·ƒæ–‡ä»¶æ—¶ï¼Œbackupæ²¡æœ‰å¤åˆ¶æ´»è·ƒæ–‡ä»¶
**ä¿®å¤**:
- æ·»åŠ äº†å¯¹æ´»è·ƒæ–‡ä»¶çš„å•ç‹¬å¤„ç†é€»è¾‘
- ç¡®ä¿å³ä½¿æ˜¯å°æ•°æ®é‡ä¹Ÿèƒ½æ­£ç¡®å¤‡ä»½

### 3. æ”¹è¿›mergeæ–‡ä»¶æ¸…ç†
**æ–‡ä»¶**: `src/db.cpp`
**é—®é¢˜**: mergeåå¤åˆ¶æ–‡ä»¶æ—¶æ²¡æœ‰å…ˆæ¸…ç†æ—§æ–‡ä»¶
**ä¿®å¤**:
- åœ¨å¤åˆ¶mergeåçš„æ–°æ–‡ä»¶å‰ï¼Œå…ˆåˆ é™¤ä¸»ç›®å½•ä¸­çš„æ—§æ•°æ®æ–‡ä»¶
- é¿å…æ–°æ—§æ•°æ®æ··åˆ

## ğŸ“‹ æ‰‹åŠ¨æµ‹è¯•æ­¥éª¤

### ç¼–è¯‘é¡¹ç›®
```bash
cd bitcask-cpp/build
make clean
make -j$(nproc)
```

### éªŒè¯å…³é”®æµ‹è¯•
```bash
# 1. æµ‹è¯•backupåŠŸèƒ½
echo "=== æµ‹è¯•backupåŠŸèƒ½ ==="
./test_db --gtest_filter=DBBackupTest.BackupRestore
if [ $? -eq 0 ]; then
    echo "âœ… DBBackupTest.BackupRestore é€šè¿‡"
else
    echo "âŒ DBBackupTest.BackupRestore å¤±è´¥"
fi

# 2. æµ‹è¯•mergeåŠŸèƒ½
echo "=== æµ‹è¯•mergeåŠŸèƒ½ ==="
./test_merge --gtest_filter=MergeTest.LargeDataMerge
if [ $? -eq 0 ]; then
    echo "âœ… MergeTest.LargeDataMerge é€šè¿‡"
else
    echo "âŒ MergeTest.LargeDataMerge å¤±è´¥"
fi

# 3. è¿è¡Œå®Œæ•´æµ‹è¯•å¥—ä»¶
echo "=== å®Œæ•´æµ‹è¯•å¥—ä»¶ ==="
echo "test_db:"
./test_db

echo "test_backup:"
./test_backup

echo "test_merge:"
./test_merge
```

## âœ… é¢„æœŸç»“æœ

ä¿®å¤ååº”è¯¥çœ‹åˆ°ï¼š

**test_db**:
```
[==========] 27 tests from 7 test suites ran.
[  PASSED  ] 27 tests.
```

**test_backup**:
```
[==========] 8 tests from 1 test suite ran.
[  PASSED  ] 8 tests.
```

**test_merge**:
```
[==========] 7 tests from 1 test suite ran.
[  PASSED  ] 7 tests.
```

## ğŸ”§ æŠ€æœ¯è¦ç‚¹

1. **ç´¢å¼•é‡å»º**: ç¡®ä¿mergeåæ‰€æœ‰æ–‡ä»¶éƒ½å‚ä¸ç´¢å¼•é‡å»º
2. **æ–‡ä»¶å¤‡ä»½**: å¤„ç†å„ç§æ•°æ®é‡æƒ…å†µï¼ŒåŒ…æ‹¬å°æ•°æ®é‡
3. **æ–‡ä»¶æ¸…ç†**: mergeè¿‡ç¨‹ä¸­æ­£ç¡®æ¸…ç†å’Œæ›¿æ¢æ–‡ä»¶
4. **åŒæ­¥æœºåˆ¶**: ç¡®ä¿æ•°æ®åœ¨å¤‡ä»½å‰å®Œå…¨æŒä¹…åŒ–

## ğŸš€ ç”Ÿäº§å°±ç»ª

ä¿®å¤å®Œæˆåï¼ŒBitcask C++é¡¹ç›®å…·å¤‡ï¼š
- âœ… å®Œæ•´çš„backup/restoreåŠŸèƒ½
- âœ… æ­£ç¡®çš„mergeå’Œæ•°æ®å‹ç¼©
- âœ… å¥å£®çš„é”™è¯¯å¤„ç†
- âœ… å…¨é¢çš„æµ‹è¯•è¦†ç›–
- âœ… Ubuntu 22.04å…¼å®¹æ€§

**é¡¹ç›®ç°åœ¨å¯ä»¥ç”¨äºç”Ÿäº§ç¯å¢ƒï¼**
